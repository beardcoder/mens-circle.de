<html
    xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
    xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
    xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
    data-namespace-typo3-fluid="true"
>
<f:layout name="Module" />

<f:section name="Before">
    <f:be.pageRenderer
        includeJavaScriptModules="{
            0: '@typo3/rte-ckeditor/ckeditor5.js'
        }"
    />
</f:section>

<f:section name="Content">
    <form method="post" action="{be:route.path(route: 'menscircle_newsletter.save')}">
        <input type="hidden" name="newsletter[uid]" value="{newsletter.uid}">

        <div class="row">
            <div class="col-md-8">
                <div class="card card-default mb-4">
                    <div class="card-header">
                        <h3 class="card-title">
                            <f:if condition="{isNew}">
                                <f:then>Create Newsletter</f:then>
                                <f:else>Edit Newsletter</f:else>
                            </f:if>
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label" for="subject">Subject *</label>
                            <input type="text" class="form-control" id="subject" name="newsletter[subject]" value="{newsletter.subject}" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="preheader">Preheader</label>
                            <input type="text" class="form-control" id="preheader" name="newsletter[preheader]" value="{newsletter.preheader}">
                            <small class="form-text text-muted">Preview text shown in email clients (max 255 characters)</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label" for="content">Content *</label>
                            <textarea class="form-control" id="content" name="newsletter[content]" rows="20" required>{newsletter.content}</textarea>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="d-flex justify-content-between">
                            <be:link.route route="menscircle_newsletter" class="btn btn-default">
                                <core:icon identifier="actions-close" /> Cancel
                            </be:link.route>
                            <button type="submit" class="btn btn-primary">
                                <core:icon identifier="actions-save" /> Save Newsletter
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <f:if condition="{!isNew}">
                    <div class="card card-default mb-4">
                        <div class="card-header">
                            <h3 class="card-title">Status</h3>
                        </div>
                        <div class="card-body">
                            <p>
                                <strong>Status:</strong>
                                <f:switch expression="{newsletter.status.value}">
                                    <f:case value="0">
                                        <span class="badge bg-secondary">Draft</span>
                                    </f:case>
                                    <f:case value="1">
                                        <span class="badge bg-info">Scheduled</span>
                                    </f:case>
                                    <f:case value="2">
                                        <span class="badge bg-warning">Sending</span>
                                    </f:case>
                                    <f:case value="3">
                                        <span class="badge bg-success">Sent</span>
                                    </f:case>
                                    <f:case value="4">
                                        <span class="badge bg-danger">Failed</span>
                                    </f:case>
                                </f:switch>
                            </p>
                            <f:if condition="{newsletter.sentAt}">
                                <p>
                                    <strong>Sent:</strong>
                                    <f:format.date format="d.m.Y H:i">{newsletter.sentAt}</f:format.date>
                                </p>
                            </f:if>
                            <f:if condition="{newsletter.recipientsCount} > 0">
                                <p>
                                    <strong>Recipients:</strong> {newsletter.recipientsCount}<br>
                                    <strong>Sent:</strong> {newsletter.sentCount}<br>
                                    <strong>Failed:</strong> {newsletter.failedCount}
                                </p>
                            </f:if>
                        </div>
                    </div>

                    <div class="card card-default mb-4">
                        <div class="card-header">
                            <h3 class="card-title">Send Test Email</h3>
                        </div>
                        <div class="card-body">
                            <form method="post" action="{be:route.path(route: 'menscircle_newsletter.sendTest', arguments: '{newsletter: newsletter.uid}')}">
                                <div class="mb-3">
                                    <input type="email" class="form-control" name="email" placeholder="test@example.com" required>
                                </div>
                                <button type="submit" class="btn btn-info btn-sm w-100">
                                    <core:icon identifier="actions-envelope" /> Send Test
                                </button>
                            </form>
                        </div>
                    </div>

                    <f:if condition="{newsletter.canSend()}">
                        <div class="card card-default">
                            <div class="card-header bg-success text-white">
                                <h3 class="card-title">Send Newsletter</h3>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Send this newsletter to all active subscribers.</p>
                                <form method="post" action="{be:route.path(route: 'menscircle_newsletter.send', arguments: '{newsletter: newsletter.uid}')}">
                                    <button type="submit" class="btn btn-success w-100" onclick="return confirm('Are you sure you want to send this newsletter to all active subscribers?')">
                                        <core:icon identifier="actions-envelope" /> Send to All Subscribers
                                    </button>
                                </form>
                            </div>
                        </div>
                    </f:if>
                </f:if>
            </div>
        </div>
    </form>
</f:section>
