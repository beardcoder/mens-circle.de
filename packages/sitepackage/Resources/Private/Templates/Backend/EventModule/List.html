<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      data-namespace-typo3-fluid="true">

<f:layout name="Module" />

<f:section name="Content">
    <div class="module-body">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Alle Events</h1>
            <div>
                <f:link.action action="index" class="btn btn-secondary">
                    <f:be.icon identifier="actions-home" /> Dashboard
                </f:link.action>
                <be:link.newRecord table="tx_sitepackage_domain_model_event" pid="1" class="btn btn-success">
                    <f:be.icon identifier="actions-add" /> Neues Event
                </be:link.newRecord>
            </div>
        </div>

        <!-- Filter Tabs -->
        <ul class="nav nav-tabs mb-3" role="tablist">
            <li class="nav-item" role="presentation">
                <f:link.action 
                    action="list" 
                    arguments="{filter: 'all'}" 
                    class="nav-link {f:if(condition: '{currentFilter} == \'all\'', then: 'active')}">
                    Alle ({totalCount})
                </f:link.action>
            </li>
            <li class="nav-item" role="presentation">
                <f:link.action 
                    action="list" 
                    arguments="{filter: 'upcoming'}" 
                    class="nav-link {f:if(condition: '{currentFilter} == \'upcoming\'', then: 'active')}">
                    <f:be.icon identifier="actions-clock" /> Kommende ({upcomingCount})
                </f:link.action>
            </li>
            <li class="nav-item" role="presentation">
                <f:link.action 
                    action="list" 
                    arguments="{filter: 'past'}" 
                    class="nav-link {f:if(condition: '{currentFilter} == \'past\'', then: 'active')}">
                    <f:be.icon identifier="actions-check" /> Vergangene ({pastCount})
                </f:link.action>
            </li>
            <li class="nav-item" role="presentation">
                <f:link.action 
                    action="list" 
                    arguments="{filter: 'published'}" 
                    class="nav-link {f:if(condition: '{currentFilter} == \'published\'', then: 'active')}">
                    <f:be.icon identifier="actions-toggle-on" /> Veröffentlicht
                </f:link.action>
            </li>
        </ul>

        <f:if condition="{events -> f:count()} > 0">
            <f:then>
                <div class="card">
                    <div class="card-body p-0">
                        <table class="table table-striped table-hover mb-0">
                            <thead>
                                <tr>
                                    <th style="width: 30%">Titel</th>
                                    <th style="width: 12%">Datum</th>
                                    <th style="width: 12%">Uhrzeit</th>
                                    <th style="width: 15%">Ort</th>
                                    <th style="width: 10%" class="text-center">Anmeldungen</th>
                                    <th style="width: 8%" class="text-center">Frei</th>
                                    <th style="width: 10%">Status</th>
                                    <th style="width: 13%">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody>
                                <f:for each="{events}" as="event">
                                    <tr class="{f:if(condition: event.isPast, then: 'table-secondary')}">
                                        <td>
                                            <strong>{event.title}</strong>
                                            <f:if condition="{event.isPast}">
                                                <br><small class="text-muted">(vergangen)</small>
                                            </f:if>
                                        </td>
                                        <td>
                                            <f:format.date format="d.m.Y">{event.eventDate}</f:format.date>
                                        </td>
                                        <td>
                                            <f:if condition="{event.startTimeFormatted}">
                                                {event.startTimeFormatted}
                                                <f:if condition="{event.endTimeFormatted}">
                                                    <br><small class="text-muted">bis {event.endTimeFormatted}</small>
                                                </f:if>
                                            </f:if>
                                        </td>
                                        <td>
                                            {event.location}
                                            <f:if condition="{event.city}">
                                                <br><small class="text-muted">{event.city}</small>
                                            </f:if>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-primary fs-6">
                                                {event.confirmedRegistrationsCount} / {event.maxParticipants}
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <f:if condition="{event.isFull}">
                                                <f:then>
                                                    <span class="badge bg-danger fs-6">Voll</span>
                                                </f:then>
                                                <f:else>
                                                    <span class="badge bg-success fs-6">{event.availableSpots}</span>
                                                </f:else>
                                            </f:if>
                                        </td>
                                        <td>
                                            <f:if condition="{event.isPublished}">
                                                <f:then>
                                                    <span class="badge bg-success">
                                                        <f:be.icon identifier="actions-toggle-on" /> Öffentlich
                                                    </span>
                                                </f:then>
                                                <f:else>
                                                    <span class="badge bg-secondary">
                                                        <f:be.icon identifier="actions-toggle-off" /> Entwurf
                                                    </span>
                                                </f:else>
                                            </f:if>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <f:link.action action="show" arguments="{event: event}" class="btn btn-info" title="Details anzeigen">
                                                    <f:be.icon identifier="actions-eye" />
                                                </f:link.action>
                                                <be:link.editRecord uid="{event.uid}" table="tx_sitepackage_domain_model_event" class="btn btn-warning" title="Bearbeiten">
                                                    <f:be.icon identifier="actions-open" />
                                                </be:link.editRecord>
                                                <f:link.action 
                                                    action="togglePublish" 
                                                    arguments="{event: event}" 
                                                    class="btn btn-{f:if(condition: event.isPublished, then: 'secondary', else: 'success')}" 
                                                    title="{f:if(condition: event.isPublished, then: 'Veröffentlichung aufheben', else: 'Veröffentlichen')}">
                                                    <f:be.icon identifier="actions-toggle-{f:if(condition: event.isPublished, then: 'off', else: 'on')}" />
                                                </f:link.action>
                                            </div>
                                        </td>
                                    </tr>
                                </f:for>
                            </tbody>
                        </table>
                    </div>
                </div>
            </f:then>
            <f:else>
                <div class="alert alert-info">
                    <h4 class="alert-heading">
                        <f:switch expression="{currentFilter}">
                            <f:case value="upcoming">Keine kommenden Events</f:case>
                            <f:case value="past">Keine vergangenen Events</f:case>
                            <f:case value="published">Keine veröffentlichten Events</f:case>
                            <f:defaultCase>Keine Events vorhanden</f:defaultCase>
                        </f:switch>
                    </h4>
                    <p class="mb-3">
                        <f:switch expression="{currentFilter}">
                            <f:case value="upcoming">Es sind aktuell keine kommenden Events geplant.</f:case>
                            <f:case value="past">Es wurden noch keine Events durchgeführt.</f:case>
                            <f:case value="published">Es gibt noch keine veröffentlichten Events.</f:case>
                            <f:defaultCase>Beginnen Sie mit der Erstellung Ihres ersten Events.</f:defaultCase>
                        </f:switch>
                    </p>
                    <be:link.newRecord table="tx_sitepackage_domain_model_event" pid="1" class="btn btn-primary">
                        <f:be.icon identifier="actions-add" /> Neues Event erstellen
                    </be:link.newRecord>
                </div>
            </f:else>
        </f:if>
    </div>
</f:section>
</html>
